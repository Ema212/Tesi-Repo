# {.appendix}

This appendix contains the full source code for analyses and graphs executed in Chapter 4.

Analyses were conducted with R, version 4.1.1 (2021-08-10).
Power analysis was conducted with "pwr" package [@Champely2020]
Graphs were created using package "ggplot2" [@wickham2016]

**Power calculation and graphs**

```r
#START SESSION
rm(list = ls())                               #Clear all objects from workspace

#POWER ANALYSIS

##Required packages
library(pwr)                                  #Load the package


##Setting parameters for the simulation

ds     = c(0.50, 0.55, 0.60)                       #Multiple effect sizes, where
                                                      #0.55 is Choen's d 
                                                      #plausible effect size
                                                      #0.50 and 0.60 are two 
                                                      #scenarios effect sizes 
                                                      #from the reasonable range 
                                                      #of sesoi within effect 
                                                      #sizes  converted to between 
alpha  = 0.05                                      #Significance level  
powers = c(0.70, 0.80, 0.90)                       #Setting different power 
                                                   #scenarios (/70%,80%,90%))

##Power analysis function

calc_n = function(d, power, alpha = 0.05) {        #This function calculates 
                                                   #the sample size, given:
  out = pwr.t.test(d = d,                             #effect size
                    power = power,                    #desired powers 
                    sig.level = alpha,                #significance levels
                    type = "two.sample",              #two independent groups
                    alternative = "two.sided")        #two tailed test
  ceiling(out$n)                                      #round up to nearest integer
}

n_per_group = sapply(ds, function(d) {        #For each effect size in ds
  sapply(powers, function(pw) calc_n(d, pw, alpha))#sample for ALL power levels
})

##Show Result 
results = data.frame(                         #creates a data frame that enlists:
  d_between    = rep(ds, each = length(powers)),    #Repeats each d for all powers
  power        = rep(powers, times = length(ds)),   #Repeats powers for each d
  n_per_group  = c(n_per_group),                    #Flattens the matrix
  total_sample = c(n_per_group) * 2                 #Total participants (2 groups)
)

print(results)                                    #shows table of results

#ILLUSTRATIVE GRAPHS

##Required Packages
library(ggplot2)                                   #Load the package

##Grpahs

#Create empty list to store all combinations
res_list = list()                                

#Generate all effect size and power combinations
for (d in ds) {                                   
  for (pw in powers) {
    
    #Calculate required sample size for current combination
    n_pg <- calc_n(d, pw, alpha)
    
    #Store results in data frame and add to list
    res_list[[length(res_list) + 1]] <- data.frame(
      d_between = d,          #Current effect size
      power = pw,             #Current power level 
      n_per_group = n_pg      #Calculated sample size per group
    ) 
  }
}

#Combine all list elements into single data frame
df <- do.call(rbind, res_list)

#Creating plot for required sample size per group by power and effect size
ggplot(df, aes(x = power, y = n_per_group,
               group = factor(d_between),     #Separate line for each effect size
               color = factor(d_between))) +  #Different color for each effect size
  
  #Plot elements
  geom_line(linewidth = 1) +                  #Connect points with lines
  geom_point(size = 2) +                      #Connect points with lines
  geom_text(aes(label = n_per_group),         #Add sample size labels above points
            vjust = -0.6, size = 3, show.legend = FALSE) +
  
  #Axis formatting
  scale_x_continuous(breaks = powers,                    #Set x-axis breaks 
                                                         #at power levels
                     labels = paste0(powers*100, "%")) + #Format as percentages
  
  #Y-axis limits - set fixed range for consistent appearance
  scale_y_continuous(limits = c(30, 90)) +               #Fix max and min range
  
  #Labels and titles
  labs(
    title = NULL,             #(Title and labels were set null for clarity 
                              #once added to the final document)
    x     = NULL,                    #Desired power - Axis
    y     = NULL,                    #Sample size per group - Axis
    color = "Effect size (d)"        #Legend title
  ) +
  
  #Theme settings
  theme_minimal(base_size = 12) +
  theme(
    text = element_text(family = "serif"),      #Set all text to Times New Roman
    legend.text = element_text(size = 15)
  )

#------------------------------------------------------------------------------

#VISUALIZING PLAUSIBLE EFFECT SIZE AND SESOI MATCHING

#Package required
library(ggplot2)

#CREATE DATA FRAMES FOR PLOTTING
effs = data.frame(             #Creates empty data 
  x = c(0, 0.22, 0.43, 0.72),     #SESOI positions 
  y = c(1, 2, 3, 4)               #Vertical positions for layout
)

poly_df = data.frame(             #Coordinates for diamond-shaped polygon
  x = c(0.27, 0.44, 0.61, 0.44), 
  y = c(0.50, 0.56, 0.50, 0.44)
)

#PLAUSIBLE ES GRAPH
graph_p = ggplot(effs, aes(x = x, y = y)) +   #SPACE FOR THE GRAPH
  theme_classic() + 
  theme(
    axis.line.y = element_line(color = "white"),
    axis.text.x = element_text(size = 10, color = "black", family= "Times"),
    axis.text.y = element_blank(), 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(), 
    axis.ticks.y = element_blank()
  ) +
  coord_cartesian(xlim = c(0, 1), ylim = c(0, 1)) +
  
  # Polygon descripting the effect size diistribution
  geom_polygon(
    data = poly_df,
    aes(x = x, y = y, group = 1),
    inherit.aes = FALSE,
    fill = "#f7a072",
    colour = "black",
    size = 0.4,
    alpha = 0.8
  )

print(graph_p)

#SESOI GRAPH
graph_s = ggplot(effs, aes(x = x, y = y)) +
  theme_classic() + 
  theme(
    axis.line.y = element_line(color = "white"),
    axis.text.x = element_text(size = 10, color = "black", family= "Times"),
    axis.text.y = element_blank(), 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(), 
    axis.ticks.y = element_blank()
  ) +
  coord_cartesian(xlim = c(0, 1), ylim = c(0, 1)) +
  
  #layer interni (linee/segmenti)
  geom_vline(xintercept = 0.22, linetype = 2, color = "#1b3a60") +
  geom_vline(xintercept = 0.43, linetype = 2, color = "#6b8e23") +
  geom_vline(xintercept = 0.72, linetype = 2, color = "#a52a2a") +
  geom_segment(x= 0.22, y = -1, xend = 0.22, yend= 0.5, colour = "#1b3a60") +
  geom_segment(x= 0.43, y = -1, xend = 0.43, yend= 0.5, colour = "#6b8e23") +
  geom_segment(x= 0.72, y = -1, xend = 0.72, yend= 0.5, colour = "#a52a2a")

print(graph_s)


#GRAPH MATCHED
graph_m = ggplot(effs, aes(x = x, y = y)) +
  theme_classic() + 
  theme(
    axis.line.y = element_line(color = "white"),
    axis.text.x = element_text(size = 10, color = "black", family= "Times"),
    axis.text.y = element_blank(), 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(), 
    axis.ticks.y = element_blank()
  ) +
  coord_cartesian(xlim = c(0, 1), ylim = c(0, 1)) +
  
  #segments (same code as above)
  geom_vline(xintercept = 0.22, linetype = 2, color = "#1b3a60") +
  geom_vline(xintercept = 0.43, linetype = 2, color = "#6b8e23") +
  geom_vline(xintercept = 0.72, linetype = 2, color = "#a52a2a") +
  geom_segment(x= 0.22, y = -1, xend = 0.22, yend= 0.5, colour = "#1b3a60") +
  geom_segment(x= 0.43, y = -1, xend = 0.43, yend= 0.5, colour = "#6b8e23") +
  geom_segment(x= 0.72, y = -1, xend = 0.72, yend= 0.5, colour = "#a52a2a") +
  
  #polygon (same code as above)
  geom_polygon(
    data = poly_df,
    aes(x = x, y = y, group = 1),
    inherit.aes = FALSE,
    fill = "#f7a072",
    colour = "black",
    size = 0.6,
    alpha = 0.8
  )

print(graph_m)

```

